extends layout

block content
  .wrapper
    .content
      .space-100
      .container
        .container
          .row
            //.content-middle.mx-0.px-0
            .col-12.p-0
              .card.text-center.mt-3
                .card-header.mt-3
                  h4.text-dark 근무일지 작성
                .card-body.text-dark
                  form#workForm(name='workForm')
                    //, method='post', action='/work/insert', onsubmit='return fnCheckSubmit()')
                    .row
                      .col-lg-6.col-md-8.col-sm-6.my-1
                        .form-group
                          label.w80px 근무일
                          .d-inline-block.w220px
                            input#work_date.form-control.datetimepicker(type='text' name='work_date')
                      .col-md-6
                        .form-group
                          label.w80px 팀
                          .d-inline-block.w220px
                            input#user_team.form-control(type='text', name='work_team', value=user.user_team, readonly)
                    .row
                      .col-md-6
                        .form-group
                          label.w80px 지역
                          select#region.selectpicker(data-style="select-with-transition btn-neutral border text-dark btn-round w220px" name='region_name')
                            each item in region
                              option(value=item.region_name, selected=user.user_region===item.region_name) #{item.region_name}
                      .col-md-6
                        .form-group
                          label.w80px 현장명
                          .form-group.d-inline-block
                            input.form-control.w220px(type='text', name='work_place', value=user.work_place)
                    .row
                      .col-lg-6.col-md-8.col-sm-6.my-1
                        label.w80px 출근시간
                        .form-group.d-inline-block
                          input.form-control.w220px#timepicker_start(type='text', name='start_time', value=last_work.start_time||'')
                      .col-lg-6.col-md-8.col-sm-6.my-1
                        label.w80px 퇴근시간
                        .form-group.d-inline-block
                          input.form-control.w220px#timepicker_end(type='text', name='end_time', value=last_work.end_time)
                      .col-lg-6.col-md-8.col-sm-6.my-1
                        label.w80px 작업사항
                        .form-group.d-none(title='work_title')
                          .d-flex.w220px
                            input.form-control(type='text', name='work_title_etc')
                            a.addon-switch-selectbox(href='#', onclick='fnChangeSelect("work_title")') 작업선택
                        select#work_title.selectpicker(data-style="select-with-transition btn-neutral border text-dark btn-round w220px" data-live-search="true" name='work_title')
                          each item in work_title
                            option(value=item.work_title, selected=last_work.work_title===item.work_title) #{item.work_title}
                          option(value='직접입력' onselect='fnChangeSelect("work_title")') 직접입력
                      .col-lg-6.col-md-8.col-sm-6.my-1
                        label.w80px 비고
                        .form-group.d-none(title='remarks')
                          .d-flex.w220px
                            input.form-control(type='text', name='remarks_etc')
                            a.addon-switch-selectbox(href='#', onclick='fnChangeSelect("remarks")') 비고선택
                        select#remarks.selectpicker(data-style="select-with-transition btn-neutral border text-dark btn-round w220px" name='remarks')
                          each item in remark
                            option(value=item.remark) #{item.remark}
                          option(value='직접입력' onselect='fnChangeSelect("remarks")') 직접입력
                    .row.justify-content-center
                      button.btn.btn-success(type='button' onclick='fnCheckSubmit()') 등록하기
                        i.now-ui-icons.ui-1_check
                    input(type='hidden', name='temp_start_time', value=last_work.start_time)
                    input(type='hidden', name='temp_end_time', value=last_work.end_time)
  // 달력선택 모달창
  style.
    #selectCalendarModal .bootstrap-datetimepicker-widget table td.day>div,
    #selectedRangeModal .bootstrap-datetimepicker-widget table td.day>div{z-index:1200;}
    #selectCalendarModal .glyphicon, #selectedRangeModal .glyphicon{font-family: "Font Awesome 5 Free"; font-weight: 900;}
    #selectCalendarModal .glyphicon.glyphicon-chevron-left:before,
    #selectedRangeModal .glyphicon.glyphicon-chevron-left:before {content: "\f053";}
    #selectCalendarModal .glyphicon.glyphicon-chevron-right:before,
    #selectedRangeModal .glyphicon.glyphicon-chevron-right:before{content: "\f054";}
    #selectedRangeModal .bootstrap-datetimepicker-widget table td.selected>div{background-color: #6c757d;color: #fff;box-shadow: 0 1px 10px 0 rgba(0, 0, 0, .2);}
  #selectCalendarModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby="selectCalendarModalLabel", aria-hidden="true", style='z-index:1100;')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5#selectCalendarModalLabel.modal-title 달력선택
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          #datepicker-inline
        .modal-footer.justify-content-center
          button.btn.btn-primary(type="button" data-dismiss="modal") 선택
  #selectedRangeModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby="selectedRangeModalLabel", aria-hidden="true", style='z-index:1100;')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5#selectedRangeModalLabel.modal-title 달력선택
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          .form-group
            label 기간
            input.form-control.rounded-0(type='text', name='selectedRange', style='flex:1')
            input.form-control.rounded-0.ml-3(type='hidden', name='period', style='width:6rem;')
          .d-flex.justify-content-around
            .start-wrarp.mr-3
              //.header.h6 시작
              #datepickerStart
            .end-wrap
              //.header.h6 끝
              #datepickerEnd
        .modal-footer.justify-content-center
          button.btn.btn-primary(type="button" onclick='fnSelectedPeriod()') 선택
  // 공지사항 모달창
  #noticeModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='noticeModalLabel', aria-hidden='true')
    .modal-dialog.modal-lg(role='document')
      .modal-content
        .modal-header
          h5#noticeModalLabel.modal-title 공지사항
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body.text-center
          ul.list-group.list-group-flush
            li.list-group-item.list-group-item-primary
              .row
                .d-none.d-md-block.col-md-1 #
                .col-9.col-md-5 제목
                .col-3.col-md-3 작성자
                .d-none.d-md-block.col-md-3 작성일
            if(notice_list.length > 0)
              each row, idx in notice_list
                - var isNew = row.read_user.toString().indexOf(user._id);
                - var date = new Date(row.created);
                li.list-group-item
                  .row
                    .d-none.d-md-block.col-md-1 #{idx + 1}
                    .col-9.col-md-5
                      if(isNew === -1)
                        img.mr-2(src='/assets/svg/new_2.svg', width=18)
                      a(href='/notice/read/' + row._id) #{row.title}
                    .col-3.col-md-3 #{row.writer}
                    .d-none.d-md-block.col-md-3 #{date.toLocaleString('ko', {hour12:false, year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'})}
            else
              li.list-group-item
                .row
                  .col 등록된 글이 없습니다.

        .modal-footer.justify-content-center
          button.btn.btn-danger.mr-3(type="button" data-dismiss="modal") 닫기
  // 휴무계 모달창
  style.
    #reportDate{position:relative;}
  #closedModal.modal.fade(tabindex="-1", role="dialog", aria-labelledby="closedModalLabel", aria-hidden="true")
    .modal-dialog.modal-lg(role="document")
      .modal-content
        .modal-header
          h5#closedModalLabel.modal-title 휴무계 작성
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          form#formClosed
            .table.table-responsive
              table.table.text-center.table-bordered#tableClosed
                colgroup
                  col(style='background-color:#aaa;')
                  col(style='background-color:#aaa;')
                  col(width=200)
                  col(width=200)
                  col(width=200)
                tbody
                  tr
                    th.text-nowrap(rowspan=2, width='80px') 신청구분
                    th.text-nowrap(width='60px') 유급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='annualLeave', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 연차
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='reserveForces', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 예비군/민방위훈련
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='familyEvent', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 경조사(취업규칙에근거)
                  tr
                    th 무급
                    td(colspan=2)
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='Absenteeism', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 무단결근(현장보고 및 본사에 휴가계 사후제출 시)
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='tardy', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 지각/조퇴
                  tr
                    th(colspan=2, rowspan=2) 신청인
                    td 부서
                    td 직급
                    td 성명
                  tr
                    td.input-td
                      input(type='text', name='department', value=user.user_team)
                    td.input-td
                      input(type='text', name='rank')
                    td.input-td
                      input(type='text', name='user_nick', value=user.user_nick)
                  tr
                    th(colspan=2, rowspan=2) 신청기간
                    td.input-td(colspan=3)
                      input#application_period(type='text', name='application_period')
                  tr
                    td(colspan=3)
                      | ( &nbsp;
                      input.text-center.type_num(type='text', name='days')
                      | &nbsp; ) &nbsp; 일 간
                  tr
                    th(colspan=2) 사유
                    td.input-td(colspan=3)
                      input(type='text', name='reason')
                  tr
                    th(colspan=2, rowspan=2) 현장보고
                    td 허가자 성명
                    td 보고일시
                    td 허가자 연락처
                  tr
                    td.input-td
                      input(type='text', name='licenserName')
                    td.input-td
                      input#reportDate(type='text', name='reportDate')
                    td.input-td
                      input(type='text', name='licenserTel')
            p 위와 같이 휴무계를 사용하고자 하오니 허가하여 주시기 바랍니다.
            - var date = new Date();
            .text-right
              input.type_num.text-center(type='text', name='closed_year', value=date.getFullYear(), readonly)
              span 년
              input.type_num.text-center(type='text', name='closed_month', value=date.getMonth() + 1, readonly)
              span 월
              input.type_num.text-center(type='text', name='closed_day', value=date.getDate(), readonly)
              span 일
            br
            p.text-danger.mb-0 ※ 휴무의 당일 현장보고 및 회사보고 = 무급에 해당함.
            p.text-danger &nbsp;&nbsp;&nbsp; 단, 병가로 인한 경우 병원 진단서 또는 진료확인서 제출시에는 연차 처리 가능.
            h4 KTOP Inc. 대표이사 귀하

        .modal-footer.justify-content-center
          button.btn.btn-danger.mr-3(type="button" data-dismiss="modal") 닫기
          button.btn.btn-info(type="button", onclick='fnCompleteWrite()') 작성완료
block append_js
  script(src='/assets/js/custom/work.js', type='text/javascript')
  script.
    console.log(!{JSON.stringify(user)});
    console.log(!{JSON.stringify(notice_list)})
    let user = !{JSON.stringify(user)};
    if(user.lv === 9) $('#closedModal').modal('show');
    // alert('add');
