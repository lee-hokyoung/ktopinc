extends layout

block content
  .wrapper
    .content
      .space-100
      .container
        .row
          .col-12
            .card.text-center.mt-3
              .card-header.mt-3
                h4.text-dark 휴무계 작성 리스트
                .row
                  .col-md-2.ml-auto
                    a.btn.btn-link.text-primary(href='#', data-toggle='modal', data-target='#closedWriteModal') 휴무계작성
              .card-body.text-dark.overflow-auto(style='max-height:60vh')
                ul.list-group.list-group-flush.text-left
                  li.list-group-item.font-weight-bold.bg-secondary.text-white
                    .row
                      .d-none.d-md-block.col-md-1 순번
                      .col-12.col-md-3 기간
                      .col-5.col-md-3 사유
                      .col-4.col-md-2 보고일시
                      .d-none.d-md-block.col-4.col-md-2 작성일
                      .col-3.col-md-1 상태
                  if(list.length === 0)
                    li.list-group-item
                      .row
                        .col-12.text-center 작성된 휴무계가 없습니다
                  each row, idx in list
                    - var status = row.status === 1 ? '정상':row.status === 2? '삭제요청':'삭제';
                    a(href='#', onclick='fnReadDoc("' + row._id + '")')
                      li.list-group-item.px-2(class=idx % 2 === 1 ? 'list-group-item-secondary':'')
                        .row
                          .d-none.d-md-block.col-md-1 #{idx + 1}
                          .col-12.col-md-3 #{row.application_period}
                          .col-5.col-md-3 #{row.reason}
                          .col-4.col-md-2 #{row.reportDate}
                          .d-none.d-md-block.col-4.col-md-2 #{row.closed_year}.#{row.closed_month}.#{row.closed_day}
                          .col-3.col-md-1 #{status}
  // 달력선택 모달창
  style.
    .file-wrap {font-size: 12px; border: 1px solid #ccc;}
    .file-wrap label {background-color: lightblue; padding: .25rem .5rem; margin-bottom: 0;}
    .file-wrap input {background-color: lightyellow;}
  #selectCalendarModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby="selectCalendarModalLabel", aria-hidden="true", style='z-index:1100;')
    .modal-dialog.modal-sm(role='document')
      .modal-content
        .modal-header
          h5#selectCalendarModalLabel.modal-title 달력선택
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          #datepicker-inline
        .modal-footer.justify-content-center
          button.btn.btn-primary(type="button" data-dismiss="modal") 선택
  #selectedRangeModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby="selectedRangeModalLabel", aria-hidden="true", style='z-index:1100;')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5#selectedRangeModalLabel.modal-title 달력선택
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          .form-group
            label 기간
            input.form-control.rounded-0(type='text', name='selectedRange', style='flex:1')
            input.form-control.rounded-0.ml-3(type='hidden', name='period', style='width:6rem;')
          .row
            .col-md-6
              .start-wrarp.mr-3
                //.header.h6 시작
                #datepickerStart
            .col-md-6
              .end-wrap
                //.header.h6 끝
                #datepickerEnd
        .modal-footer.justify-content-center
          button.btn.btn-primary(type="button" onclick='fnSelectedPeriod()') 선택
  // 휴무계 모달창
  #closedWriteModal.modal.fade(tabindex="-1", role="dialog", aria-labelledby="closedWriteModalLabel", aria-hidden="true")
    .modal-dialog.modal-lg(role="document")
      .modal-content
        .modal-header
          h5#closedWriteModalLabel.modal-title 휴무계 작성
          button.close.text-dark(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          form#formClosed
            .table.table-responsive.mb-0
              table.table.text-center.table-bordered#tableClosed
                colgroup
                  col(style='background-color:#aaa;')
                  col(style='background-color:#aaa;')
                  col(width=200)
                  col(width=200)
                  col(width=200)
                tbody
                  tr
                    th.text-nowrap(rowspan=2, width='80px') 신청구분
                    th.text-nowrap(width='60px') 유급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='annualLeave', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 연차
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='reserveForces', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 예비군/민방위훈련
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='familyEvent', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 경조사(취업규칙에근거)
                  tr
                    th 무급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='noPay', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 무급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='Absenteeism', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 무단결근
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='tardy', onclick='fnSelectType(this)')
                          span.form-check-sign
                          | 지각/조퇴
                  tr
                    th(colspan=2, rowspan=2) 신청인
                    td 부서
                    td 직급
                    td 성명
                  tr
                    td.input-td
                      input(type='text', name='department', value=user.user_team)
                    td.input-td
                      input(type='text', name='rank')
                    td.input-td
                      input(type='text', name='user_nick', value=user.user_nick)
                  tr
                    th(colspan=2, rowspan=2) 신청기간
                    td.input-td(colspan=3)
                      input#application_period(type='text', name='application_period')
                  tr
                    td(colspan=3)
                      | ( &nbsp;
                      input.text-center.type_num(type='text', name='days')
                      | &nbsp; ) &nbsp; 일 간
                  tr
                    th(colspan=2) 사유
                    td.input-td(colspan=3)
                      input(type='text', name='reason')
                  tr
                    th(colspan=2, rowspan=2) 현장보고
                    td 허가자 성명
                    td 보고일시
                    td 허가자 연락처
                  tr
                    td.input-td
                      input(type='text', name='licenserName')
                    td.input-td
                      input#reportDate(type='text', name='reportDate')
                    td.input-td
                      input(type='text', name='licenserTel')
            .input-group.mb-3
              .file-wrap
                label(for='closedAttach').text-nowrap 첨부파일
                input#closedAttach(type='file', name='closedAttach[]', multiple, style='max-width:200px;')
              //label(for='closedAttach') 첨부파일
            p 위와 같이 휴무계를 사용하고자 하오니 허가하여 주시기 바랍니다.
            - var date = new Date();
            .text-right
              input.type_num.text-center(type='text', name='closed_year', value=date.getFullYear(), readonly)
              span 년
              input.type_num.text-center(type='text', name='closed_month', value=date.getMonth() + 1, readonly)
              span 월
              input.type_num.text-center(type='text', name='closed_day', value=date.getDate(), readonly)
              span 일
            br
            p.text-danger.mb-0 ※ 휴무의 당일 현장보고 및 회사보고 = 무급에 해당함.
            p.text-danger &nbsp;&nbsp;&nbsp; 단, 병가로 인한 경우 병원 진단서 또는 진료확인서 제출시에는 연차 처리 가능.
            h4 KTOP Inc. 대표이사 귀하

        .modal-footer.justify-content-center
          button.btn.btn-danger.mr-3(type="button" data-dismiss="modal") 닫기
          button.btn.btn-info(type="button", onclick='fnCompleteWrite()') 작성완료
    input(type='hidden', name='closedAttachOriginalFileName')
    input(type='hidden', name='closedAttachPath')
  #closedModal.modal.fade(tabindex="-1", role="dialog", aria-labelledby="closedModalLabel", aria-hidden="true")
    .modal-dialog.modal-lg(role="document")
      .modal-content
        .modal-header
          h5#closedModalLabel.modal-title 휴무계 작성
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') x
        .modal-body
          form#formClosedRead
            .table.table-responsive
              table.table.text-center.table-bordered#tableClosedRead
                colgroup
                  col(style='background-color:#aaa;')
                  col(style='background-color:#aaa;')
                  col(width=200)
                  col(width=200)
                  col(width=200)
                tbody
                  tr
                    th.text-nowrap(rowspan=2, width='80px') 신청구분
                    th.text-nowrap(width='60px') 유급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='annualLeave', disabled)
                          span.form-check-sign
                          | 연차
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='reserveForces', disabled)
                          span.form-check-sign
                          | 예비군/민방위훈련
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='familyEvent', disabled)
                          span.form-check-sign
                          | 경조사(취업규칙에근거)
                  tr
                    th 무급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='noPay', disabled)
                          span.form-check-sign
                          | 무급
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='Absenteeism', disabled)
                          span.form-check-sign
                          | 무단결근
                    td
                      .form-check.text-left.text-nowrap
                        label.form-check-label
                          input.form-check-input(type="checkbox", name='closed_type', value='tardy', disabled)
                          span.form-check-sign
                          | 지각/조퇴
                  tr
                    th(colspan=2, rowspan=2) 신청인
                    td 부서
                    td 직급
                    td 성명
                  tr
                    td.input-td
                      input(type='text', name='department', readonly)
                    td.input-td
                      input(type='text', name='rank', readonly)
                    td.input-td
                      input(type='text', name='user_nick', readonly)
                  tr
                    th(colspan=2, rowspan=2) 신청기간
                    td.input-td(colspan=3)
                      input(type='text', name='application_period', readonly)
                  tr
                    td(colspan=3)
                      | ( &nbsp;
                      input.text-center.type_num(type='text', name='days', readonly)
                      | &nbsp; ) &nbsp; 일 간
                  tr
                    th(colspan=2) 사유
                    td.input-td(colspan=3)
                      input(type='text', name='reason', readonly)
                  tr
                    th(colspan=2, rowspan=2) 현장보고
                    td 허가자 성명
                    td 보고일시
                    td 허가자 연락처
                  tr
                    td.input-td
                      input(type='text', name='licenserName', readonly)
                    td.input-td
                      input(type='text', name='reportDate', readonly)
                    td.input-td
                      input(type='text', name='licenserTel', readonly)
              #closedAttachedFile
            p 위와 같이 휴무계를 사용하고자 하오니 허가하여 주시기 바랍니다.
            .text-right
              input.type_num.text-center(type='text', name='closed_year', readonly)
              span 년
              input.type_num.text-center(type='text', name='closed_month', readonly)
              span 월
              input.type_num.text-center(type='text', name='closed_day', readonly)
              span 일
            br
            p.text-danger.mb-0 ※ 휴무의 당일 현장보고 및 회사보고 = 무급에 해당함.
            p.text-danger &nbsp;&nbsp;&nbsp; 단, 병가로 인한 경우 병원 진단서 또는 진료확인서 제출시에는 연차 처리 가능.
            h4 KTOP Inc. 대표이사 귀하
            .row
              .col-md-6(title='isImproveFileUploaded')
                a(name='updatedImproveFile', target='_blank')
              .col-md-6(title='isNotImproveFileUploaded')
                .input-group
                  input.form-control(type="file", name='fileImprove')
                  button.btn.btn-primary.my-0(type='button', onclick='fnUploadImprove()') 증빙파일제출
        .modal-footer.justify-content-center
          button.btn.btn-danger.mr-3(type="button" data-dismiss="modal") 닫기
          button.btn.btn-info(type="button", name='btnDelete', onclick='fnDeleteDoc()') 삭제요청
          input(type='hidden', name='doc_id')
block append_js
  script(src='/assets/js/custom/closed.js', type='text/javascript')
  script.
    console.log(!{JSON.stringify(list)});
    console.log(!{JSON.stringify(user)});