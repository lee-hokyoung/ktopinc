extends layout

block content
  .container-fluid.p-0
    form
      .card(style='margin-top:5rem;')
        .card-header
        .card-body.p-2
          .report
            .row
              .col
                .h5.font-weight-bold
                  input(type='number', name='year', value=data.year, readonly)
                  span.mr-3 년
                  input(type='number', name='month', value=data.month, readonly)
                  span.mr-3 월
                  span 월간업무보고서
            .row.h6.location_info
              .col-12.col-md-1
                span 현장명 :
              .col-6.col-md-2.d-flex.justify-content-start
                input(type='text', name='field', value=data.field)
                span.mr-3 현장,
              .col-6.col-md-2
                input(type='text', name='line', value=data.line)
                span 라인
            .row.h6.location_info
              .col-12.col-md-1
                span 직급, 성명 :
              .col-6.col-md-2.d-flex.justify-content-start
                span.pr-3 직급 :
                input(type='text', name='rank', value=data.rank)
              .col-6.col-md-2.d-flex.justify-content-start
                span.pr-3 성명 :
                input(type='text', name='user_name', value=data.user_id.user_nick)
              .col-12.col-md-2.d-flex.justify-content-start
                span.pr-3 조정그룹 :
                input(type='text', name='align_group', value=data.align_group)
          br
          h5.font-weight-bold 1. 현장업무 보고
          .table.text-nowrap.overflow-auto
            table.table.table-bordered
              tbody(style='border:2px solid #555;')
                tr
                  td
                    h6 (* 구체적으로 기술)
                    h6 ① 본인 업무 및 역할?
                tr
                  td
                    textarea.form-control(rows=5, name='field_role') #{data.field_role}
                tr
                  td
                    h6 ② 팀원, 팀장, 현장 SV는?(협력사명 및 이름)
                tr
                  td
                    textarea.form-control(rows=5, name='field_name') #{data.field_name}
                tr
                  td
                    h6 ③ 업무 중 문제점 or 개선점은?
                tr
                  td
                    textarea.form-control(rows=5, name='field_problem') #{data.field_problem}
          br
          h5.font-weight-bold 2. 앗차사고 및 현장사고사례
          .table.accident.overflow-auto
            table.table.table-bordered
              tbody(style='border:2px solid #555;')
                tr
                  th 일 시
                  td
                    input(type='text', name='accident_date', value=data.accident_date)
                tr
                  th 장 소
                  td
                    input(type='text', name='accident_location', value=data.accident_location)
                tr
                  th 위 험 유 형
                  td
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_1.form-check-input(type="checkbox" value="넘어짐(전도)", name='accident_type', checked=data.accident_type.indexOf('넘어짐(전도)') > -1)
                        | 넘어짐(전도)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_2.form-check-input(type="checkbox" value="떨어짐(추락)", name='accident_type', checked=data.accident_type.indexOf('떨어짐(추락)') > -1)
                        | 떨어짐(추락)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_3.form-check-input(type="checkbox" value="부딪힘(충돌)", name='accident_type', checked=data.accident_type.indexOf('부딪힘(충돌)') > -1)
                        | 부딪힘(충돌)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_4.form-check-input(type="checkbox" value="끼임(협착)", name='accident_type', checked=data.accident_type.indexOf('끼임(충돌)') > -1)
                        | 끼임(협착)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_5.form-check-input(type="checkbox" value="물체에 맞음(낙하, 비례)", name='accident_type', checked=data.accident_type.indexOf('물체에 맞음(낙하, 비례)') > -1)
                        | 물체에 맞음(낙하, 비례)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_6.form-check-input(type="checkbox" value="방전스파크(감전)", name='accident_type', checked=data.accident_type.indexOf('방전스파크(감전)') > -1)
                        | 방전스파크(감전)
                        span.form-check-sign
                          span.check
                    .form-check.mr-3
                      label.form-check-label
                        input#danger_7.form-check-input(type="checkbox" value="기타(사고내용기술)", name='accident_type', checked=data.accident_type.indexOf('기타(사고내용기술)') > -1)
                        | 기타(사고내용기술)
                        span.form-check-sign
                          span.check
                tr
                  th 내 용
                  td
                    textarea.form-control(name='accident_content') !{data.accident_content}
                tr
                  th 문 제 점
                  td
                    textarea.form-control(name='accident_problem', rows=5) !{data.accident_problem}
                tr
                  th 사고대처방안
                  td
                    textarea.form-control(type='text', name='accident_manual', rows=5) !{data.accident_manual}
                tr
                  th
                    span 현장사고사례
                    h6 (*사고발생 時 작성)
                  td
                    textarea.form-control(placeholder='(* 사고내용, 협력사명 등 기술)', name='accident_example', rows=5) !{data.accident_example}
          br
          h5.font-weight-bold 3. 현장 업무 Skill 및 일본어 능력 자기 평가
          ul.list-group#businessList(style='border:2px solid #555;')
            li.list-group-item
              span ① Rail : 경력 (
              input(type='number', name='rail_year', value=data.rail_year)
              span ) 년 / (
              input(type='number', name='rail_month', value=data.rail_month)
              span ) 개월
              .d-flex.justify-content-start
                each item in ['S', 'A', 'B', 'C']
                  .form-check.form-check-radio.mr-3
                    label.form-check-label
                      input.form-check-input(type="radio", value=item, name='skill_rail_type', checked=item===data.skill_rail_type)
                      | #{item}
                      span.form-check-sign
                        span.check
            li.list-group-item
              span ② ZCU : 경력 (
                input(type='number', name='zcu_year', value=data.zcu_year)
                span ) 년 / (
                input(type='number', name='zcu_month', value=data.zcu_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_zcu_type', checked=item===data.skill_zcu_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ③ Teaching : 경력 (
                input(type='number', name='teaching_year', value=data.teaching_year)
                span ) 년 / (
                input(type='number', name='teaching_month', value=data.teaching_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_teaching_type', checked=item === data.skill_teaching_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ④ STB : 경력 (
                input(type='number', name='stb_year', value=data.stb_year)
                span ) 년 / (
                input(type='number', name='stb_month', value=data.stb_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_stb_type', checked=item === data.skill_stb_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑤ AZFS : 경력 (
                input(type='number', name='azfs_year', value=data.azfs_year)
                span ) 년 / (
                input(type='number', name='azfs_month', value=data.azfs_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_azfs_type', checked=item === data.skill_azfs_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑥ VHL : 경력 (
                input(type='number', name='vhl_year', value=data.vhl_year)
                span ) 년 / (
                input(type='number', name='vhl_month', value=data.vhl_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_vhl_type', checked=item === data.skill_vhl_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑦ HID : 경력 (
                input(type='number', name='hid_year', value=data.hid_year)
                span ) 년 / (
                input(type='number', name='hid_month', value=data.hid_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_hid_type', checked=item === data.skill_hid_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑧ CLS : 경력 (
                input(type='number', name='cls_year', value=data.cls_year)
                span ) 년 / (
                input(type='number', name='cls_month', value=data.cls_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_cls_type', checked=item === data.skill_cls_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑨ ZT : 경력 (
                input(type='number', name='zt_year', value=data.zt_year)
                span ) 년 / (
                input(type='number', name='zt_month', value=data.zt_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['S', 'A', 'B', 'C']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_zt_type', checked=item === data.skill_zt_type)
                        | #{item}
                        span.form-check-sign
                          span.check
            li.list-group-item
              span ⑩ 일본어 : 경력 (
                input(type='number', name='jp_year', value=data.jp_year)
                span ) 년 / (
                input(type='number', name='jp_month', value=data.jp_month)
                span ) 개월
                .d-flex.justify-content-start
                  each item in ['상', '중', '하']
                    .form-check.form-check-radio.mr-3
                      label.form-check-label
                        input.form-check-input(type="radio", value=item, name='skill_jp_type', checked=item === data.skill_jp_type)
                        | #{item}
                        span.form-check-sign
                          span.check
          br
          .row
            .col
              h6.text-info ※ 해당 레벨별 설명, 하나를 선택해서 ☑ 표 해주세요!
              h6.text-danger - S : Trouble 대응도 가능, 타인원에게 교육가능
              h6.text-danger - A : 1인으로 작업이 가능
              h6.text-danger - B : S or A의 지원이 있으면 작업이 가능
              h6.text-danger - C : 신입 or 거의 신입 수준
              hr
              h6.text-danger - 일본어 상 : 읽기, 쓰기, 대화 문제 없는 수준
              h6.text-danger - 일본어 중 : 읽기, 쓰기는 가능 대화에 어려움
              h6.text-danger - 일본어 하 : 완전 초보 수준
          br
          h5.font-weight-bold 4. 기숙사 점검 내용
            small (※ 아파트, 오피스텔 사용자만 작성)
          .table.accident.overflow-auto
            table.table.table-bordered
              tbody
                tr
                  th.normalTH(rowspan=2) 점검내용 기술
                  td (*바닥 및 기타 파손 및 훼손여부 기술)
                tr
                  td
                    textarea.form-control(placeholder='(숙소 점검 내용)', name='dormitory', rows=5) !{data.dormitory}
          br
          h5.font-weight-bold 5. 기타 사항
          .table.accident.overflow-auto
            table.table.table-bordered
              tbody
                tr
                  th.normalTH 하고싶은 말씀
                  td
                    textarea.form-control(placeholder='(* 자유롭게 기술하세요)', row=10, name='etc') #{data.etc}
        .card-footer
          .d-flex.justify-content-center
            button.btn.btn-success(type='button', onclick='fnSubmit()') 수정하기
            a.btn.btn-danger(href='/work/business/list') 목록으로
            input(type='hidden', name='_id', value=data._id.toString())
block append_js
  script.
    function fnSubmit(){
      let form = $('form');
      let data = form.serialize();
      let _id = document.querySelector('input[name="_id"]').value;
      let xhr = new XMLHttpRequest();
      xhr.open('PUT', '/work/business/' + _id, true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.onreadystatechange = function(){
        if(this.readyState === XMLHttpRequest.DONE && this.status === 200){
          let res = JSON.parse(this.response);
          if(res.ok === 1){
            alert('정상적으로 수정되었습니다.');
            location.href = '/work/business/list';
          }
        }
      }
      xhr.send(data);
    }